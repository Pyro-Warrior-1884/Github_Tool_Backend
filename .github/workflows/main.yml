- name: Send submission to backend
  run: |
    if [ -f encoded/code.txt ] && [ -f encoded/filename.txt ]; then
      CODE=$(cat encoded/code.txt)
      FILE=$(cat encoded/filename.txt)

      JSON=$(jq -n \
        --arg name "$COMMITTER" \
        --arg commitCount "$COMMIT_COUNT" \
        --arg timestamp "$(date -u +"%Y-%m-%dT%H:%M:%SZ")" \
        --arg filename "$FILE" \
        --arg content_b64 "$CODE" \
        '{name: $name, commitCount: $commitCount, timestamp: $timestamp, files: [{ filename: $filename, content_b64: $content_b64 }]}' \
      )

      echo "üöÄ Final JSON Payload:"
      echo "$JSON" | jq .

      curl -X POST https://github-tool-project.onrender.com/webhook \
        -H "Content-Type: application/json" \
        -d "$JSON"
    else
      echo "‚ö†Ô∏è No encoded file found. Skipping submission."
    fi
